/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  12
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    format      ascii;
    class       dictionary;
    location    "system";
    object      snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

#includeEtc "caseDicts/mesh/generation/snappyHexMeshDict.cfg"

// DONE: Aktivieren Sie nacheinander alle drei Schritte der Netzerstellung.
castellatedMesh on;

snap            on;

addLayers       on;

geometry
{
    // DONE: Geben Sie hier den Namen der Geometrie-Datei aus constant/triSurfae ein.
    // Definition of flow domain, surface regions are created from named surfaces in the .stl-file
    domain
    {
        type triSurfaceMesh;
        file "domain_a3_b1.stl";
        regions
        {
            inlet  { name inlet; }
            outlet { name outlet; }
	    top-0 { name top; }
	    top-1 { name top; }
	    top-2 { name top; }
	    top-3 { name top; }
	    bottom-0 { name bottom; }
	    bottom-1 { name bottom; }
	    bottom-2 { name bottom; }
	    bottom-3 { name bottom; }
	    wall-top-0 { name pipe-1; }
	    wall-top-1 { name pipe-3; }
	    wall-top-2 { name pipe-5; }
	    wall-center-0 { name pipe-0; }
	    wall-center-1 { name pipe-2; }
	    wall-center-2 { name pipe-4; }
	    wall-bottom-0 { name pipe-1; }
	    wall-bottom-1 { name pipe-3; }
	    wall-bottom-2 { name pipe-5; }
	    front { name front; }
	    back { name back; }
        }
    }

    // DONE: Wählen Sie die Grenzen der Box so, dass sie das Gebiet der Rohre umschließt
    // Definition of a box geometry used for refinement
    refinementBox
    {
        type searchableBox;
        min (-0.1 -0.0225 -0.002);
        max ( 0.08   0.0225  0.002);
    }

}

castellatedMeshControls
{
    resolveFeatureAngle 5;

    // DONE: Geben Sie hier den Namen der .eMesh-Datei an, die durch die surfaceFeatures-utility in "constant/triSurface" erzeugt wurde
    features
    (
        { file "domain_a3_b1.eMesh"; level 0; }
    );

    // INFO: Die refinement levels der einzelnen surfaces müssen nicht geändert werden
    refinementSurfaces
    {
        domain
        {
            level (0 0);

	    // All patches are created from surface regions
            regions
            {
                inlet
                {
                    level (0 0);
                    patchInfo
                    {
                        type patch;
                    }
                }

                outlet
                {
                    level (0 0);
                    patchInfo
                    {
                        type patch;
                    }
                }

                bottom
                {
                    level (0 0);
                    patchInfo
                    {
                        type patch;
                        inGroups (cyclic);
                    }
                }

                top
                {
                    level (0 0);
                    patchInfo
                    {
                        type patch;
                        inGroups (cyclic);
                    }
                }

                "(front|back)"
                {
                    level (0 0);
                    patchInfo
                    {
                        type patch;
                    }
                }

                "wall-.*-[0-2]"
                {
		    level (1 2);
                    patchInfo
                    {
                        type wall;
                        inGroups (wall);
                    }
                }
            }

        }
    }

    // DONE: Aktivieren Sie die Verfeinerung in der refinementBox durch entfernen des "-disabled" hinter "refinementRegions"
    // delete "-disabled" below to enable refinementRegions
    refinementRegions
    {
        refinementBox
        {
            mode    inside;
            level   1;
        }
    }

    insidePoint (-0.106 0.002 0.001);
    nCellsBetweenLevels 3;
}

snapControls
{
    explicitFeatureSnap    on;
    implicitFeatureSnap    off;
}

addLayersControls
{
    // DONE: Passen Sie die Anzahl der surface layers an, damit im Mittel ein yPlus = 1 erreicht wird. das maximale yPlus sollte 3 nicht übersteigen.
    // Um das yPlus bewerten zu können muss zunächst eine Simulation durchgeführt werden.
    layers
    {
        "pipe.*" { nSurfaceLayers 4; }
    }


    relativeSizes       on; // off, usually with firstLayerThickness
    expansionRatio      1.2;
    finalLayerThickness 0.7;
    minThickness  5e-4;
    firstLayerThickness-disabled 1.5e-4;
    maxThicknessToMedialRatio-disabled 0.3;
}

// delete "-disabled" to output mesh data, e.g. for layers
writeFlags-disabled
(
    scalarLevels
    layerSets
    layerFields
);

mergeTolerance 1e-6;

// ************************************************************************* //
